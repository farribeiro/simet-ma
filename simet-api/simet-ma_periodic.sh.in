#!/bin/sh
# SIMET Measurement Agent - run the measurements
# Copyright (c) 2018,2019 NIC.br
#
# Distributed under the GPLv3+ license with additional terms and permissions
# Refer to the COPYING file on the program source for details

set -e

[ -r @SIMETLIBDIR@/simet-ma.conf ] && . @SIMETLIBDIR@/simet-ma.conf
[ -r @SIMETCONFDIR@/simet-ma.conf ] && . @SIMETCONFDIR@/simet-ma.conf
AGENT_ID_FILE=${AGENT_ID_FILE:-@SIMETCONFDIR@/agent-id}
AGENT_TOKEN_FILE=${AGENT_TOKEN_FILE:-@SIMETCONFDIR@/agent.jwt}

if [ ! -r "$AGENT_ID_FILE" ] || [ ! -r "$AGENT_TOKEN_FILE" ] ; then
	@BINDIR@/simet_register_ma.sh
fi

exec @BINDIR@/simet-ma_run.sh --config @SIMETLIBDIR@/simet-ma.conf --config @SIMETCONFDIR@/simet-ma.conf "$@"
